<div class="app-container">
  <!-- Background ambient particles -->
  <div class="bg-particles" aria-hidden="true">
    <div class="particle p1"></div>
    <div class="particle p2"></div>
    <div class="particle p3"></div>
    <div class="particle p4"></div>
    <div class="particle p5"></div>
    <div class="particle p6"></div>
  </div>

  <!-- Scanline overlay -->
  <div class="scanlines" aria-hidden="true"></div>

  @switch (game.gameState()) {
    @case ('menu') {
      @if (showLeaderboard()) {
        <app-leaderboard (closePanel)="toggleLeaderboard()" />
      } @else {
        <!-- Menu Screen -->
        <div class="menu-screen">
          <div class="title-section">
            <h1 class="game-title">
              <span class="title-chroma">CHROMA</span><span class="title-pulse">PULSE</span>
            </h1>
            <p class="tagline">Match the colors. Beat the clock. Claim the throne.</p>
          </div>

          <div class="menu-actions">
            <button class="btn btn-primary btn-glow" (click)="startGame()">
              <span class="btn-text">START GAME</span>
              <span class="btn-hint">press SPACE</span>
            </button>
            <button class="btn btn-secondary" (click)="toggleLeaderboard()">
              LEADERBOARD
            </button>
          </div>

          <div class="how-to-play">
            <h3 class="htp-title">HOW TO PLAY</h3>
            <p class="htp-desc">Circles light up with colors. Press the matching key before time runs out!</p>
            <div class="color-keys-preview">
              <span class="preview-key" style="--pk-color: #FF3B5C">R</span>
              <span class="preview-key" style="--pk-color: #4D9FFF">B</span>
              <span class="preview-key" style="--pk-color: #00E676">G</span>
              <span class="preview-key" style="--pk-color: #FFD740">Y</span>
              <span class="preview-key" style="--pk-color: #AA46FF">P</span>
            </div>
          </div>
        </div>
      }
    }

    @case ('countdown') {
      <div class="countdown-screen">
        <div class="countdown-number">{{ game.countdownValue() }}</div>
        <p class="countdown-label">GET READY</p>
      </div>
    }

    @case ('playing') {
      <app-game-board />
    }

    @case ('gameOver') {
      <div class="game-over-screen">
        <h1 class="game-over-title">GAME OVER</h1>

        <div class="final-stats">
          <div class="final-score-box">
            <span class="final-score-label">FINAL SCORE</span>
            <span class="final-score-value">{{ game.score() | number:'1.0-0' }}</span>
          </div>
          <div class="final-details">
            <div class="final-stat">
              <span class="fs-label">Max Combo</span>
              <span class="fs-value">x{{ game.maxCombo() }}</span>
            </div>
            <div class="final-stat">
              <span class="fs-label">Accuracy</span>
              <span class="fs-value">{{ game.accuracy() }}%</span>
            </div>
            <div class="final-stat">
              <span class="fs-label">Top Speed</span>
              <span class="fs-value">{{ game.speedMultiplier() }}x</span>
            </div>
          </div>
        </div>

        @if (game.isHighScore() && !scoreSaved()) {
          <div class="high-score-entry">
            <p class="high-score-badge">&#127942; NEW HIGH SCORE!</p>
            <div class="name-input-group">
              <input
                type="text"
                class="name-input"
                placeholder="Enter your name..."
                maxlength="15"
                [value]="playerName()"
                (input)="onNameInput($event)"
                (keydown.enter)="saveScore()"
                aria-label="Enter your name for the leaderboard"
              />
              <button class="btn btn-primary btn-sm" (click)="saveScore()">SAVE</button>
            </div>
          </div>
        }

        @if (scoreSaved()) {
          <p class="saved-message">&#10003; Score saved to leaderboard!</p>
        }

        <div class="game-over-actions">
          <button class="btn btn-primary btn-glow" (click)="startGame()">PLAY AGAIN</button>
          <button class="btn btn-secondary" (click)="goToMenu()">MAIN MENU</button>
        </div>
      </div>
    }
  }
</div>
